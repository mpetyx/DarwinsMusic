<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Music stuff ...</title>
        <link rel="stylesheet" media="all" href="../jquery-jvectormap.css"/>
  
  <link rel="stylesheet" media="all" href="assets/jquery-ui.min.css"/>
  <link rel="stylesheet" media="all" href="assets/jquery.ui.theme.css"/>
  
  <script src="assets/jquery-1.8.2.js"></script>
  <script src="assets/jquery-ui-1.10.3.custom.min.js"></script>
        
  
  <script src="../jquery-jvectormap.js"></script>
  <script src="../jquery-mousewheel.js"></script>

  <script src="../lib/jvectormap.js"></script>

  <script src="../lib/abstract-element.js"></script>
  <script src="../lib/abstract-canvas-element.js"></script>
  <script src="../lib/abstract-shape-element.js"></script>

  <script src="../lib/svg-element.js"></script>
  <script src="../lib/svg-group-element.js"></script>
  <script src="../lib/svg-canvas-element.js"></script>
  <script src="../lib/svg-shape-element.js"></script>
  <script src="../lib/svg-path-element.js"></script>
  <script src="../lib/svg-circle-element.js"></script>

  <script src="../lib/vml-element.js"></script>
  <script src="../lib/vml-group-element.js"></script>
  <script src="../lib/vml-canvas-element.js"></script>
  <script src="../lib/vml-shape-element.js"></script>
  <script src="../lib/vml-path-element.js"></script>
  <script src="../lib/vml-circle-element.js"></script>

  <script src="../lib/vector-canvas.js"></script>
  <script src="../lib/simple-scale.js"></script>
  <script src="../lib/numeric-scale.js"></script>
  <script src="../lib/ordinal-scale.js"></script>
  <script src="../lib/color-scale.js"></script>
  <script src="../lib/data-series.js"></script>
  <script src="../lib/proj.js"></script>
  <script src="../lib/world-map.js"></script>
	
  <script src="assets/jquery-jvectormap-world-mill-en.js"></script>
  
  
  
    </head>
    
    <body>
		<div id="world-map-gdp" style="width: 800px; height: 600px"></div>
		<div id="slider" style="width: 280px; margin: 10px"></div>
        <script>
            $(function(){
              $.getJSON('http://localhost:8000/map', function(data){
					$.getJSON('../countries.json', function(data2){
						var val = 2000;
                        aggregatedHitsValues = jvm.values.apply({}, jvm.values(data2.hits)),
                        hitsValues = Array.prototype.concat.apply([], jvm.values(data.hits));
                        uniqueValues = Array.prototype.concat.apply([], jvm.values(data.viewers));
                        //aggregatedHitsValues = Array.prototype.concat.apply([], jvm.values(data2.hits));
                        
                        $('#world-map-gdp').vectorMap({
							map: 'world_mill_en',
							markers: data.coords,
							series: {
								markers: [{
									attribute: 'fill',
									scale: ['#FEE5D9', '#A50F15'],
									values: data.hits[val],
									min: jvm.min(hitsValues),
									max: jvm.max(hitsValues)
									},{
									attribute: 'r',
									scale: [5, 20],
									values: data.viewers[val],
									min: jvm.min(uniqueValues),
									max: jvm.max(uniqueValues)
								}],
								regions: [{
									scale: ['#DEEBF7', '#08519C'],
									attribute: 'fill',
									values: data2.hits[val],
									min: jvm.min(aggregatedHitsValues),
									max: jvm.max(aggregatedHitsValues)
								}]
							
							},
							onMarkerLabelShow: function(event, label, index){
								label.html(
									''+data.names[index]+'<br/>'+ 
									'Number of hits: '+data.hits[val][index]+'<br/>'+
									'Number of listeners: '+data.viewers[val][index]
								);
							},
							onRegionLabelShow: function(event, label, code){
								label.html(
									''+label.html()+'<br/>'+
									'Number of hits: '+data2.hits[val][code]
								);
							}
						});
						
						var mapObject = $('#world-map-gdp').vectorMap('get', 'mapObject');
					
						
						$("#slider").slider({
							value: val,
                            min: 2000, //data[0][0],
                            max: 2010, //data[data.length-1][0],
                            step: 10,
                            slide: function( event, ui ) {
								val = ui.value;
                                mapObject.series.regions[0].setValues(data2.names[ui.value]);
                                mapObject.series.markers[0].setValues(data.hits[ui.value]);
                                mapObject.series.markers[1].setValues(data.viewers[ui.value]);
							}
                        });
						
						
					});
              });
            });
        </script>
    </body>
</html>
